var e_desc = title;
var slider_images_url = images_list;
var slider_images_urlmin = images_list;

var module_inits = [];

var load_flag = true;

function load_init_modules(){
    if(!load_flag) return;

    for(var i=0;i<module_inits.length; i++){
        module_inits[i]();
    }
    load_flag = false;
}

function call_me(fun)
{
    module_inits.push(fun);
}

var ua = navigator.userAgent.toLowerCase();

function e(){

    if(ua.match(/MicroMessenger/i) != 'micromessenger'){
        load_init_modules();
        return;
    }
    const time = 2000;
    const timer = setTimeout(load_init_modules,time);
}

window.addEventListener('load', e, false);
var image_size_width=[],image_size_height=[],image_url_index=0,have_num=0,error_num=0,canshow=!0,reshow=!1,timeout=[],delaytime=1e4,createNodeArr=[],createNodeObj={},get_pid=function(e){var i=e.indexOf("?");return(e=-1!=i?e.substr(0,i):e).toString().substr(e.lastIndexOf("/")+1)};function nid(e){return createNodeObj[e]||(createNodeObj[e]=!0,createNodeArr.push(e)),document.getElementById(e)}function id(e){return document.getElementById(e)}var bl_keepload="first",step_loadnum=5;function step_load(){var e=0;if(0==image_url_index&&"first"==bl_keepload){console.log("loading continue"),bl_keepload=slider_images_url.length>step_loadnum?(e=step_loadnum,"next"):(e=slider_images_url.length,"end");for(var i=0;i<e;i++)(n=new Image).index=i,n.src=slider_images_url[i],n.onload=image_onload,n.onerror=image_onerror,Onload_imgs_url[i]="loading"}else if("end"!=bl_keepload){console.log("loading continue"),slider_images_url.length-image_url_index>2*step_loadnum?e=step_loadnum:(e=slider_images_url.length-image_url_index-step_loadnum,bl_keepload="end");for(var n,i=image_url_index+step_loadnum;i<image_url_index+step_loadnum+e;i++)(n=new Image).index=i,n.src=slider_images_url[i],n.onload=image_onload,n.onerror=image_onerror,Onload_imgs_url[i]="loading"}}function load_images(){reshow=!1,image_size_width=[],image_size_height=[],Onload_imgs_url=[],error_num=have_num=image_url_index=0,begin_titletime=(begin_titletime=new Date).getTime(),canshow=!0,showtitle(),bl_keepload="first",step_load()}function image_onerror(e){var e=e.target.index;e<step_loadnum&&error_num++,Onload_imgs_url[e]="not find",(step_loadnum<=have_num+error_num||slider_images_url.length==have_num+error_num)&&1==canshow&&(canshow=reshow=!1,0!=have_num&&(e=(e=new Date).getTime(),e=Math.abs(e-begin_titletime),delaytime<e?liangziyun_kawa():timeout.push(setTimeout(function(){liangziyun_kawa()},e=delaytime-e))))}function image_onload(e){var i;1!=reshow&&((i=(e=e.target).index)<step_loadnum&&have_num++,Onload_imgs_url[i]=e.src,image_size_height[i]=e.height,image_size_width[i]=e.width,console.log(Onload_imgs_url[i]),(step_loadnum<=have_num+error_num||slider_images_url.length==have_num+error_num)&&1==canshow&&(canshow=reshow=!1,0!=have_num&&(e=(e=new Date).getTime(),i=Math.abs(e-begin_titletime),delaytime<i?liangziyun_kawa():timeout.push(setTimeout(function(){liangziyun_kawa()},i=delaytime-i)))))}function showtitle(){timeout.push(setTimeout(function(){nid("titlecontent").innerHTML=e_desc,nid("loading").style.webkitAnimation="fadeOut 1s linear both",nid("startimgBox").style.webkitAnimation="fadeIn 1s linear both",nid("startimg").style.webkitAnimation="startimg_an 5.1s steps(1) both",nid("bookbg").style.webkitAnimation="bookbg_an 3s  5.1s linear both",nid("pagetitle").style.webkitAnimation="pagetitle_an 2.7s 4.9s linear both",nid("congimgBox").style.webkitAnimation="fadeIn 1s 3s linear both",nid("congimg").style.webkitAnimation="congimg_an 3.4s 3s steps(1) infinite",timeout.push(setTimeout(function(){nid("startimgBox").style.webkitAnimation="fadeOut 1s linear both"},4100)),timeout.push(setTimeout(function(){nid("fyimg").style.webkitAnimation="fyimg_an 1.1s steps(1) both",show1()},7200))},4e3))}function liangziyun_kawa(){}function show1(){var e=setImage("1"),i=e.style;nid("word1").innerHTML=e.desc,nid("photoBg1").style.backgroundImage="url("+e.src+")",nid("photoBg1").style.webkitAnimation=i.pagebgAn,nid("page1").style.backgroundImage="url("+e.src+")",nid("page1_block").setAttribute("style",i.block),nid("page1_block").style.webkitAnimation=i.pageAn,nid("xieimg1").style.backgroundImage="url("+e.src+")",timeout.push(setTimeout(function(){nid("scene1Box").style.zIndex=2,nid("scene2Box").style.zIndex=1,nid("scene1Box").style.webkitAnimation="maskimg_an 1.1s steps(1) both",nid("fyimg1").style.webkitAnimation="fyimg_an 1.1s steps(1) both",nid("xie1Box").style.webkitAnimation="jiaoimg_an 1.1s steps(1) both",nid("xieimg1").style.webkitAnimation="xieimg_an 1.1s linear both",show2()},3600)),timeout.push(setTimeout(function(){nid("photoBg1").style.webkitAnimation="",nid("page1_block").style.webkitAnimation="",nid("fyimg1").style.webkitAnimation="",nid("scene1Box").style.webkitAnimation="",nid("xie1Box").style.webkitAnimation="",nid("xieimg1").style.webkitAnimation="",nid("mask1Box").style.webkitAnimation=""},6e3))}function show2(){var e=setImage("2"),i=e.style;nid("word2").innerHTML=e.desc,nid("photoBg2").style.backgroundImage="url("+e.src+")",nid("photoBg2").style.webkitAnimation=i.pagebgAn,nid("page2").style.backgroundImage="url("+e.src+")",nid("page2_block").setAttribute("style",i.block),nid("page2_block").style.webkitAnimation=i.pageAn,nid("xieimg2").style.backgroundImage="url("+e.src+")",nid("maskimg2").style.backgroundImage="url("+e.src+")",timeout.push(setTimeout(function(){nid("scene2Box").style.zIndex=2,nid("scene1Box").style.zIndex=1,nid("scene2Box").style.webkitAnimation="maskimg_an 1.1s steps(1) both",nid("fyimg2").style.webkitAnimation="fyimg_an 1.1s steps(1) both",nid("xie2Box").style.webkitAnimation="jiaoimg_an 1.1s steps(1) both",nid("xieimg2").style.webkitAnimation="xieimg_an 1.1s linear both",show1()},3600)),timeout.push(setTimeout(function(){nid("photoBg2").style.webkitAnimation="",nid("page2_block").style.webkitAnimation="",nid("fyimg2").style.webkitAnimation="",nid("scene2Box").style.webkitAnimation="",nid("xie2Box").style.webkitAnimation="",nid("xieimg2").style.webkitAnimation="",nid("mask2Box").style.webkitAnimation=""},6e3))}var pageW=1,pageH=1;function getImageStyle(e,i){var n={},t=(id("container").offsetWidth,id("container").offsetHeight),e=e.width/e.height,e=(e<1?(n.width="100%",n.height="100%",n.top="0%",n.left="0%",1==pageH?(pageH=2,n.pagebgAn="photobgH1_an 5s linear both",n.pageAn="showimgH1 5s linear both"):2==pageH?(pageH=3,n.pagebgAn="",n.pageAn="showimgH2 5s linear both"):3==pageH?(pageH=4,n.pagebgAn="photobgH3_an 5s linear both",n.pageAn="showimgH3 5s linear both"):4==pageH&&(pageH=1,n.pagebgAn="photobgH4_an 5s linear both",n.pageAn="showimgH4 5s linear both")):(n.width=500,n.height=n.width/e,n.top=(t-n.height)/2-10+"px",n.left="0px",n.width+="px",n.height+="px",1==pageW?(pageW=2,n.pagebgAn="photobgW1_an 5s linear both",n.pageAn="showimgW1 5s linear both"):2==pageW?(pageW=3,n.pagebgAn="photobgW2_an 5s linear both",n.pageAn="showimgW2 5s linear both"):3==pageW?(pageW=4,n.pagebgAn="photobgW3_an 5s linear both",n.pageAn="showimgW3 5s linear both"):4==pageW&&(pageW=1,n.pagebgAn="photobgW4_an 5s linear both",n.pageAn="showimgW4 5s linear both")),{});return e.block="width:"+n.width+";height:"+n.height+";left:"+n.left+";top:"+n.top+";",e.pagebgAn=n.pagebgAn,e.pageAn=n.pageAn,console.log(n.pageAn),e}function setImage(e){if(1!=reshow){for(;"not find"==Onload_imgs_url[image_url_index]||"loading"==Onload_imgs_url[image_url_index];)image_url_index%step_loadnum==0&&step_load(),++image_url_index==Onload_imgs_url.length&&(image_url_index=0);image_url_index%step_loadnum==0&&step_load();image_size_width[image_url_index],image_size_height[image_url_index],id("word"+e);var i=words[get_pid(Onload_imgs_url[image_url_index])],i=((null==i||i.length<1)&&(i=""),{width:image_size_width[image_url_index],height:image_size_height[image_url_index],src:Onload_imgs_url[image_url_index],desc:i});return i.style=getImageStyle(i,e),++image_url_index==Onload_imgs_url.length&&(image_url_index=0),i}}function reload_scene(){clearnode(),reshow=!0,setTimeout(load_images,100)}function clearnode(){timeout.forEach(function(e){clearTimeout(e)});for(var e=0;e<createNodeArr.length;e++){var i=id(createNodeArr[e]);i&&"undefined"!==i&&(i.style.webkitAnimation="")}}call_me(load_images);